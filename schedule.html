<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thá»i KhÃ³a Biá»ƒu CÃ¡ NhÃ¢n</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
            vertical-align: top;
        }
        th {
            background: #007bff;
            color: white;
        }
        .schedule-item {
            background: #f0f0f0;
            margin: 5px;
            padding: 5px;
            border-radius: 5px;
            position: relative;
        }
        .edit-btn, .delete-btn {
            margin-left: 5px;
            cursor: pointer;
            color: red;
        }
    </style>
</head>
<body>
    <h2>Thá»i KhÃ³a Biá»ƒu CÃ¡ NhÃ¢n</h2>
    <input type="date" id="chonNgay" onchange="capNhatTuan()">
    <button id="themLichBtn" onclick="themLich()">ThÃªm Lá»‹ch</button>
    <table>
        <tr>
            <th>Thá»© Hai</th>
            <th>Thá»© Ba</th>
            <th>Thá»© TÆ°</th>
            <th>Thá»© NÄƒm</th>
            <th>Thá»© SÃ¡u</th>
            <th>Thá»© Báº£y</th>
            <th>Chá»§ Nháº­t</th>
        </tr>
        <tr>
            <td id="mon"></td>
            <td id="tue"></td>
            <td id="wed"></td>
            <td id="thu"></td>
            <td id="fri"></td>
            <td id="sat"></td>
            <td id="sun"></td>
        </tr>
    </table>

    <script>
        function capNhatTuan() {
            let chonNgay = document.getElementById("chonNgay").value;
            if (!chonNgay) return;

            let ngayTrongTuan = new Date(chonNgay);
            ngayTrongTuan.setDate(ngayTrongTuan.getDate() - ngayTrongTuan.getDay() + 1);
            
            let days = ["mon", "tue", "wed", "thu", "fri", "sat", "sun"];
            for (let i = 0; i < 7; i++) {
                let date = new Date(ngayTrongTuan);
                date.setDate(ngayTrongTuan.getDate() + i);
                document.getElementById(days[i]).setAttribute("data-date", date.toISOString().split('T')[0]);
            }
        }

        function themLich() {
            let day = prompt("Nháº­p thá»© (mon/tue/wed/thu/fri/sat/sun):");
            if (!document.getElementById(day)) {
                alert("Thá»© nháº­p khÃ´ng há»£p lá»‡!");
                return;
            }

            let name = prompt("Nháº­p tÃªn lá»‹ch:");
            let time = prompt("Nháº­p thá»i gian (HH:MM):");
            let note = prompt("Nháº­p ghi chÃº:");

            if (!name || !time || !/^\d{2}:\d{2}$/.test(time)) {
                alert("ThÃ´ng tin nháº­p khÃ´ng há»£p lá»‡!");
                return;
            }

            let parent = document.getElementById(day);
            let date = parent.getAttribute("data-date");
            if (!date) {
                alert("Vui lÃ²ng chá»n ngÃ y Ä‘á»ƒ xÃ¡c Ä‘á»‹nh thá»i khÃ³a biá»ƒu trong tuáº§n");
                return;
            }

            let timeMoi = parseTime(time);
            let TKBCN = Array.from(parent.children);
            
            for (let item of TKBCN) {
                let timeTruoc = parseTime(item.dataset.time);
                if (Math.abs(timeTruoc - timeMoi) < 60) {
                    alert("Thá»i gian lá»‹ch pháº£i cÃ¡ch Ã­t nháº¥t 1 giá».");
                    return;
                }
            }

            let motLich = document.createElement("div");
            motLich.className = "schedule-item";
            motLich.dataset.time = time;
            motLich.innerHTML = `<strong>${name}</strong><br>
                ğŸ•’ ${time} - ğŸ“… ${date}<br>
                ğŸ“ ${note}<br>
                <span class='edit-btn' onclick='chinhSuaLich(this)'>âœï¸</span>
                <span class='delete-btn' onclick='xoaLich(this)'>ğŸ—‘ï¸</span>`;

            parent.appendChild(motLich);
            sapXepLich(day);
        }

        function parseTime(time) {
            let [hour, minute] = time.split(":").map(Number);
            return hour * 60 + minute;
        }

        function sapXepLich(day) {
            let parent = document.getElementById(day);
            let TKBCN = Array.from(parent.children);
            TKBCN.sort((a, b) => parseTime(a.dataset.time) - parseTime(b.dataset.time));
            parent.innerHTML = "";
            TKBCN.forEach(s => parent.appendChild(s));
        }

        function chinhSuaLich(element) {
            let parent = element.parentElement;
            let name = prompt("Nháº­p tÃªn lá»‹ch má»›i:", parent.children[0].innerText);
            let time = prompt("Nháº­p thá»i gian má»›i:", parent.dataset.time);
            let note = prompt("Nháº­p ghi chÃº má»›i:", parent.children[2].innerText);

            if (!name || !time || !/^\d{2}:\d{2}$/.test(time)) {
                alert("ThÃ´ng tin nháº­p khÃ´ng há»£p lá»‡!");
                return;
            }

            parent.dataset.time = time;
            parent.innerHTML = `<strong>${name}</strong><br>
                ğŸ•’ ${time} - ğŸ“… ${parent.parentElement.getAttribute("data-date")}<br>
                ğŸ“ ${note}<br>
                <span class='edit-btn' onclick='chinhSuaLich(this)'>âœï¸</span>
                <span class='delete-btn' onclick='xoaLich(this)'>ğŸ—‘ï¸</span>`;

            sapXepLich(parent.parentElement.id);
        }

        function xoaLich(element) {
            element.parentElement.remove();
        }
    </script>
</body>
</html>