<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th·ªùi Kh√≥a Bi·ªÉu C√° Nh√¢n</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
            vertical-align: top;
        }
        th {
            background: #007bff;
            color: white;
        }
        .schedule-item {
            background: #f0f0f0;
            margin: 5px;
            padding: 5px;
            border-radius: 5px;
            position: relative;
        }
        .edit-btn, .delete-btn {
            margin-left: 5px;
            cursor: pointer;
            color: red;
        }
    </style>
</head>
<body>
    <h2>Th·ªùi Kh√≥a Bi·ªÉu C√° Nh√¢n</h2>
    <input type="date" id="chonNgay" onchange="capNhatTuan()">
    <button id="themLichBtn" onclick="themLich()">Th√™m L·ªãch</button>
    <table>
        <tr>
            <th>Th·ª© Hai</th>
            <th>Th·ª© Ba</th>
            <th>Th·ª© T∆∞</th>
            <th>Th·ª© NƒÉm</th>
            <th>Th·ª© S√°u</th>
            <th>Th·ª© B·∫£y</th>
            <th>Ch·ªß Nh·∫≠t</th>
        </tr>
        <tr>
            <td id="mon"></td>
            <td id="tue"></td>
            <td id="wed"></td>
            <td id="thu"></td>
            <td id="fri"></td>
            <td id="sat"></td>
            <td id="sun"></td>
        </tr>
    </table>
 <!-- h·ªôp tho·∫°i nh·∫≠p khi th√™m l·ªãch -->
    <div id="modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border: 1px solid #ccc; box-shadow: 0px 0px 10px rgba(0,0,0,0.2); z-index: 1000;">
        <h3>Th√™m L·ªãch M·ªõi</h3>

        <label>Ch·ªçn ng√†y:</label>
        <input type="date" id="modalDate" onchange="capNhatNgayTuModal()"><br><br>

        <label>Ch·ªçn th·ª©:</label>
        <select id="modalDay">
            <option value="mon">Th·ª© Hai</option>
            <option value="tue">Th·ª© Ba</option>
            <option value="wed">Th·ª© T∆∞</option>
            <option value="thu">Th·ª© NƒÉm</option>
            <option value="fri">Th·ª© S√°u</option>
            <option value="sat">Th·ª© B·∫£y</option>
            <option value="sun">Ch·ªß Nh·∫≠t</option>
        </select><br><br>

        <label>T√™n l·ªãch:</label>
        <input type="text" id="modalName"><br><br>

        <label>Th·ªùi gian (HH:MM):</label>
        <input type="time" id="modalTime"><br><br>

        <label>Ghi ch√∫:</label>
        <input type="text" id="modalNote"><br><br>

        <button onclick="luuLich()">OK</button>
        <button onclick="dongModal()">H·ªßy</button>
    </div>
    <div 
    id="overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5);">
    </div>

     <!-- h·ªôp tho·∫°i ch·ªânh s·ª≠a l·ªãch ƒë√£ c√≥ s·∫µn -->
     <div id="editModal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border: 1px solid #ccc; box-shadow: 0px 0px 10px rgba(0,0,0,0.2); z-index: 1000;">
        <h3>Ch·ªânh S·ª≠a L·ªãch</h3>
        <label>Ch·ªçn ng√†y:</label>
        <input type="date" id="editDate"><br><br>

        <label>T√™n l·ªãch:</label>
        <input type="text" id="editName"><br><br>
    
        <label>Th·ªùi gian (HH:MM):</label>
        <input type="time" id="editTime"><br><br>
    
        <label>Ghi ch√∫:</label>
        <input type="text" id="editNote"><br><br>
    
        <button onclick="luuChinhSua()">L∆∞u</button>
        <button onclick="dongEditModal()">H·ªßy</button>
    </div>
    <div id="editOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5);"></div>
    <script>
        function capNhatNgayTuModal() {
            let modalDate = document.getElementById("modalDate").value;
            if (!modalDate) return;

            // C·∫≠p nh·∫≠t ng√†y v√†o #chonNgay
            document.getElementById("chonNgay").value = modalDate;

            // X√°c ƒë·ªãnh th·ª© trong tu·∫ßn
            let ngay = new Date(modalDate);
            let thu = ngay.getDay(); // 0 = Ch·ªß Nh·∫≠t, 1 = Th·ª© Hai, ..., 6 = Th·ª© B·∫£y

            let days = ["sun", "mon", "tue", "wed", "thu", "fri", "sat"];
            let thuTuongUng = days[thu]; // L·∫•y th·ª© t∆∞∆°ng ·ª©ng

            // C·∫≠p nh·∫≠t v√†o #modalDay
            document.getElementById("modalDay").value = thuTuongUng;

            // G·ªçi l·∫°i c·∫≠p nh·∫≠t tu·∫ßn ƒë·ªÉ ƒë·∫£m b·∫£o l·ªãch hi·ªÉn th·ªã ƒë√∫ng
            capNhatTuan();
        }

        function capNhatTuan() {
            let chonNgay = document.getElementById("chonNgay").value;
            if (!chonNgay) return;

            let ngayTrongTuan = new Date(chonNgay);
            ngayTrongTuan.setDate(ngayTrongTuan.getDate() - ngayTrongTuan.getDay() + 1);
            
            let days = ["mon", "tue", "wed", "thu", "fri", "sat", "sun"];
            for (let i = 0; i < 7; i++) {
                let date = new Date(ngayTrongTuan);
                date.setDate(ngayTrongTuan.getDate() + i);
                document.getElementById(days[i]).setAttribute("data-date", date.toISOString().split('T')[0]);
            }
        }

        function themLich() {
    document.getElementById("modal").style.display = "block";
    document.getElementById("overlay").style.display = "block";
}

function dongModal() {
    document.getElementById("modal").style.display = "none";
    document.getElementById("overlay").style.display = "none";
}

function luuLich() {
    let day = document.getElementById("modalDay").value;
    let name = document.getElementById("modalName").value;
    let time = document.getElementById("modalTime").value;
    let note = document.getElementById("modalNote").value;

    if (!name || !time) {
        alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
        return;
    }

    let parent = document.getElementById(day);
    let date = parent.getAttribute("data-date");
    if (!date) {
        alert("Vui l√≤ng ch·ªçn ng√†y ƒë·ªÉ x√°c ƒë·ªãnh th·ªùi kh√≥a bi·ªÉu trong tu·∫ßn");
        return;
    }

    let motLich = document.createElement("div");
    motLich.className = "schedule-item";
    motLich.dataset.time = time;
    motLich.innerHTML = `<strong>${name}</strong><br>
        üïí ${time} - üìÖ ${date}<br>
        üìù ${note}<br>
        <span class='edit-btn' onclick='chinhSuaLich(this)'>‚úèÔ∏è</span>
        <span class='delete-btn' onclick='xoaLich(this)'>üóëÔ∏è</span>`;

    parent.appendChild(motLich);
    sapXepLich(day);
    
    dongModal(); // ƒê√≥ng modal sau khi l∆∞u
}

        function parseTime(time) {
            let [hour, minute] = time.split(":").map(Number);
            return hour * 60 + minute;
        }

        function sapXepLich(day) {
            let parent = document.getElementById(day);
            let TKBCN = Array.from(parent.children);
            TKBCN.sort((a, b) => parseTime(a.dataset.time) - parseTime(b.dataset.time));
            parent.innerHTML = "";
            TKBCN.forEach(s => parent.appendChild(s));
        }
        // n√∫t ch·ªânh s·ª≠a trong tkb
        let currentEditElement = null;

        function chinhSuaLich(element) {
            currentEditElement = element.parentElement;

            let name = currentEditElement.querySelector("strong").innerText;
            let time = currentEditElement.dataset.time;
            let note = currentEditElement.querySelector(".schedule-note")?.innerText || "";
            let date = currentEditElement.parentElement.getAttribute("data-date");

            document.getElementById("editDate").value = date;
            document.getElementById("editName").value = name;
            document.getElementById("editTime").value = time;
            document.getElementById("editNote").value = note;

            document.getElementById("editModal").style.display = "block";
            document.getElementById("editOverlay").style.display = "block";
        }

        function luuChinhSua() {
            let date = document.getElementById("editDate").value;
            let name = document.getElementById("editName").value;
            let time = document.getElementById("editTime").value;
            let note = document.getElementById("editNote").value;

            if (!name || !time.match(/^\d{2}:\d{2}$/) || !date) {
                alert("Th√¥ng tin nh·∫≠p kh√¥ng h·ª£p l·ªá!");
                return;
            }

            let oldParent = currentEditElement.parentElement;
            let days = {"mon": 1, "tue": 2, "wed": 3, "thu": 4, "fri": 5, "sat": 6, "sun": 0};
            let newDate = new Date(date);
            let newDay = Object.keys(days).find(key => days[key] === newDate.getDay());
            let newParent = document.getElementById(newDay);

            currentEditElement.dataset.time = time;
            currentEditElement.innerHTML = `
                <strong>${name}</strong><br>
                üïí ${time} - üìÖ ${date}<br>
                <span class='schedule-note'>üìù ${note}</span><br>
                <span class='edit-btn' onclick='chinhSuaLich(this)'>‚úèÔ∏è</span>
                <span class='delete-btn' onclick='xoaLich(this)'>üóëÔ∏è</span>
            `;

            newParent.appendChild(currentEditElement);
            sapXepLich(newDay);
            dongEditModal();
        }

        // X√°c nh·∫≠n tr∆∞·ªõc khi x√≥a l·ªãch
        function xoaLich(element) {
            if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a l·ªãch n√†y kh√¥ng?")) {
                element.parentElement.remove();
            }
        }
        function dongEditModal() {
            document.getElementById("editModal").style.display = "none";
            document.getElementById("editOverlay").style.display = "none";
        }
       
    </script>
</body>
</html>